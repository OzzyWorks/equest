<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ENGLISH QUEST - MASTER</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: #000; color: #fff; font-family: sans-serif; }
    body { display: flex; flex-direction: column; box-sizing: border-box; padding: 10px; }
    
    /* ÁîªÈù¢Êè∫„Çå */
    @keyframes shake {
      0%, 100% { transform: translate(0,0); }
      20% { transform: translate(-5px, 0); }
      40% { transform: translate(5px, 0); }
      60% { transform: translate(-5px, 0); }
      80% { transform: translate(5px, 0); }
    }
    .shake { animation: shake 0.3s; }

    /* ËÉåÊôØ */
    #game-screen {
      flex: 1; display: flex; flex-direction: column;
      background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 40%, #228b22 40%, #006400 100%);
      border: 4px solid #fff; border-radius: 8px; position: relative; overflow: hidden;
    }
    #mountain {
      position: absolute; top: 30%; left: 0; width: 100%; height: 15%;
      background: #004d00; clip-path: polygon(0% 100%, 15% 20%, 30% 70%, 50% 10%, 70% 60%, 85% 30%, 100% 100%);
    }

    #monster-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 2; }
    #monster-image { font-size: 10vh; filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.5)); transition: transform 0.2s; }
    #monster-name-box { background: rgba(0,0,0,0.8); padding: 2px 12px; border: 2px solid #fff; border-radius: 4px; margin-bottom: 5px; font-weight: bold; }
    
    /* „Éú„Çπ„Çø„Ç§„Éû„Éº */
    #boss-timer {
      display: none; position: absolute; top: 10px; right: 10px;
      background: #000; color: #ff0000; border: 2px solid #ff0000;
      padding: 5px; font-family: monospace; text-align: center; width: 65px;
    }
    #timer-fill { height: 4px; background: #ff0000; width: 100%; margin-top: 2px; }

    /* UI */
    #ui-area { flex: 1.4; display: flex; flex-direction: column; background: #000; border: 4px solid #fff; border-radius: 8px; margin-top: 8px; padding: 10px; }
    #status { display: flex; justify-content: space-around; font-size: 0.8rem; border-bottom: 2px solid #fff; padding-bottom: 8px; margin-bottom: 5px; }
    
    /* HP„Åå‰Ωé„ÅÑÊôÇ„ÅÆËµ§Â≠ó */
    .hp-danger { color: #ff4757; font-weight: bold; animation: blink 0.5s infinite alternate; }
    @keyframes blink { from { opacity: 1; } to { opacity: 0.5; } }

    #question { font-size: 0.9rem; text-align: center; min-height: 2.8em; display: flex; align-items: center; justify-content: center; }
    #choices { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    #choices button { padding: 12px 5px; font-size: 0.75rem; background: #000; color: #fff; border: 2px solid #fff; border-radius: 4px; }
    
    #heal-btn { 
      display: none; width: 100%; margin-top: 5px; padding: 10px; 
      background: #2ed573; color: #fff; border: none; border-radius: 4px; font-weight: bold; 
    }

    #log { font-size: 0.8rem; color: #ffff00; text-align: center; margin: 5px 0; height: 1.2em; }
    #next { width: 100%; padding: 12px; background: #fff; color: #000; font-weight: bold; border: none; display: none; }
    
    .correct { background: #2ecc71 !important; }
    .wrong { background: #e74c3c !important; }
  </style>
</head>
<body id="main-body">

  <div id="game-screen">
    <div id="mountain"></div>
    <div id="boss-timer">TIME:<span id="time-num">10</span><div id="timer-fill"></div></div>
    
    <div id="monster-area">
      <div id="monster-name-box"><span id="monster-name">...</span></div>
      <div id="monster-image">üêæ</div>
      <div style="width:60%; height:8px; background:#444; border:1px solid #fff; margin-top:8px;">
        <div id="monster-hp" style="height:100%; background:#f00; width:100%; transition:width 0.2s;"></div>
      </div>
    </div>
  </div>

  <div id="ui-area">
    <div id="status">
      <div>LV: <span id="level">1</span></div>
      <div id="hp-box">HP: <span id="hp">100</span></div>
      <div>Â±ûÊÄß: <span id="p-element">üî•</span></div>
    </div>
    <div id="question"></div>
    <button id="heal-btn">üåø Ëñ¨Ëçâ„Çí‰Ωø„ÅÜ (HPÂÖ®ÂõûÂæ©)</button>
    <div id="choices"></div>
    <div id="log"></div>
    <button id="next">‚ñ∂ „Å§„Åé„ÅÆ„Éê„Éà„É´„Å∏</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let player = { level: 1, exp: 0, hp: 100, element: "üî•", winCount: 0 };
      const elements = { "üî•": "üíß", "üíß": "üåø", "üåø": "üî•" };
      let timerInt;
      let timeLeft = 10;
      let isBoss = false;

      // ÂïèÈ°å„É™„Çπ„ÉàÔºàÈáçË§áÈò≤Ê≠¢„ÅÆ„Åü„ÇÅ„ÄÅ„Åì„Åì„Åã„Çâpool„Å∏ÁßªÂãï„Åï„Åõ„ÇãÔºâ
      const masterQuestions = [
        { q: "I (  ) to the park yesterday.", choices: ["went", "go", "gone", "going"], a: "went" },
        { q: "This is the car (  ) he bought.", choices: ["which", "who", "whom", "whose"], a: "which" },
        { q: "„Äåenvironment„Äç„ÅÆÊÑèÂë≥„ÅØÔºü", choices: ["Áí∞Â¢É", "ÊîøÂ∫ú", "ÁøíÊÖ£", "ÊúüÂæÖ"], a: "Áí∞Â¢É" },
        { q: "„Äåtake care (  )„Äç„Åß„Äå‰∏ñË©±„Çí„Åô„Çã„Äç", choices: ["of", "for", "to", "at"], a: "of" },
        { q: "He is (  ) than I am.", choices: ["taller", "tall", "tallest", "more tall"], a: "taller" },
        { q: "If I (  ) a bird, I would fly.", choices: ["were", "am", "was", "is"], a: "were" },
        { q: "I have (  ) to Kyoto twice.", choices: ["been", "gone", "be", "go"], a: "been" },
        { q: "„Äåopportunity„Äç„ÅÆÊÑèÂë≥„ÅØÔºü", choices: ["Ê©ü‰ºö", "Â†¥ÊâÄ", "ÊôÇÈñì", "ÊàêÂäü"], a: "Ê©ü‰ºö" },
        { q: "She (  ) lunch now.", choices: ["is eating", "eats", "ate", "eaten"], a: "is eating" },
        { q: "„Äålook forward (  )„Äç„Åß„ÄåÊ•Ω„Åó„Åø„Å´„Åô„Çã„Äç", choices: ["to", "at", "for", "on"], a: "to" },
        { q: "It is easy (  ) me to swim.", choices: ["for", "of", "to", "at"], a: "for" },
        { q: "My father (  ) me a watch.", choices: ["gave", "give", "given", "giving"], a: "gave" }
      ];

      let pool = [...masterQuestions].sort(() => Math.random() - 0.5);
      let usedPool = [];

      function nextBattle() {
        player.winCount++;
        isBoss = player.winCount % 5 === 0;
        
        const monsters = [{n:"„Çπ„É©„Ç§„É†",i:"üíß",t:"üíß"},{n:"„Éâ„É©„Ç≠„Éº",i:"ü¶á",t:"üåø"},{n:"„Ç¥„Éº„Çπ„Éà",i:"üëª",t:"üî•"}];
        const bosses = [{n:"„Çä„ÇÖ„ÅÜ„Åä„ÅÜ",i:"üê≤",t:"üî•"},{n:"„Éù„Çª„Ç§„Éâ„É≥",i:"üî±",t:"üíß"},{n:"Â§ßÈï∑ËÄÅ",i:"üå≥",t:"üåø"}];
        
        let m = isBoss ? bosses[Math.floor(Math.random()*bosses.length)] : monsters[Math.floor(Math.random()*monsters.length)];
        window.currentMonster = { ...m, maxHp: isBoss ? 200 : 50, hp: isBoss ? 200 : 50 };

        document.getElementById("monster-name").textContent = (isBoss ? "BOSS: " : "") + window.currentMonster.n;
        document.getElementById("monster-image").textContent = window.currentMonster.i;
        document.getElementById("boss-timer").style.display = isBoss ? "block" : "none";
        document.getElementById("next").style.display = "none";
        document.getElementById("log").textContent = "";
        
        loadQuestion();
        updateDisplay();
      }

      function loadQuestion() {
        clearInterval(timerInt);
        
        // ÈáçË§áÈò≤Ê≠¢„É≠„Ç∏„ÉÉ„ÇØ
        if (pool.length === 0) {
          pool = [...usedPool].sort(() => Math.random() - 0.5);
          usedPool = [];
        }
        const qData = pool.pop();
        usedPool.push(qData);

        document.getElementById("question").textContent = qData.q;
        const choicesEl = document.getElementById("choices");
        choicesEl.innerHTML = "";

        [...qData.choices].sort(()=>Math.random()-0.5).forEach(c => {
          const btn = document.createElement("button");
          btn.textContent = c;
          btn.onclick = () => checkAnswer(c, qData.a, btn);
          choicesEl.appendChild(btn);
        });

        if (isBoss) startBossTimer();
      }

      function startBossTimer() {
        timeLeft = 10;
        updateTimerUI();
        timerInt = setInterval(() => {
          timeLeft -= 0.1;
          updateTimerUI();
          if (timeLeft <= 0) {
            clearInterval(timerInt);
            // „Éú„ÇπÊà¶ÊôÇÈñìÂàá„ÇåÂá¶ÁêÜ
            handleDamage(20, "ÊôÇÈñìÂàá„ÇåÔºÅ„ÉÄ„É°„Éº„Ç∏ÔºÅ");
            setTimeout(loadQuestion, 600); // Ê¨°„ÅÆÂïèÈ°å„Å∏
          }
        }, 100);
      }

      function updateTimerUI() {
        document.getElementById("time-num").textContent = Math.ceil(timeLeft);
        document.getElementById("timer-fill").style.width = (timeLeft * 10) + "%";
      }

      function checkAnswer(choice, answer, btn) {
        clearInterval(timerInt);
        const buttons = document.querySelectorAll("#choices button");
        buttons.forEach(b => {
          b.disabled = true;
          if(b.textContent === answer) b.classList.add("correct");
        });

        if (choice === answer) {
          let damage = (elements[player.element] === window.currentMonster.t) ? 60 : 25;
          window.currentMonster.hp -= damage;
          document.getElementById("log").textContent = "Ê≠£Ëß£ÔºÅ ÊîªÊíÉÔºÅ";
          document.getElementById("monster-image").style.transform = "scale(1.3)";
          setTimeout(()=>document.getElementById("monster-image").style.transform="scale(1)",150);
        } else {
          btn.classList.add("wrong");
          handleDamage(20, "‰∏çÊ≠£Ëß£ÔºÅ");
        }

        setTimeout(() => {
          if (window.currentMonster.hp <= 0) {
            document.getElementById("log").textContent = "ÂãùÂà©ÔºÅ";
            player.exp += isBoss ? 100 : 30;
            document.getElementById("next").style.display = "block";
            levelUpCheck();
          } else if (player.hp <= 0) {
            document.getElementById("log").textContent = "ÂÖ®ÊªÖ„Åó„Åü...";
            player.hp = 100; player.winCount = 0;
            document.getElementById("next").textContent = "‚ñ∂ Âæ©Ê¥ª„Åô„Çã";
            document.getElementById("next").style.display = "block";
          } else {
            loadQuestion();
          }
          updateDisplay();
        }, 800);
      }

      function handleDamage(dmg, msg) {
        player.hp -= dmg;
        document.getElementById("log").textContent = msg;
        document.getElementById("main-body").classList.add("shake");
        setTimeout(() => document.getElementById("main-body").classList.remove("shake"), 300);
        updateDisplay();
      }

      function updateDisplay() {
        const hpEl = document.getElementById("hp");
        hpEl.textContent = player.hp;
        
        // HP„Å´„Çà„Çã
