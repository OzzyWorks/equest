<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ENGLISH QUEST - PERFECT BALANCE</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: #000; color: #fff; font-family: sans-serif; }
    body { display: flex; flex-direction: column; box-sizing: border-box; padding: 10px; }
    
    /* ç”»é¢æºã‚Œã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
    @keyframes shake {
      0% { transform: translate(1px, 1px); }
      20% { transform: translate(-3px, 0px); }
      40% { transform: translate(1px, -1px); }
      60% { transform: translate(-3px, 1px); }
      80% { transform: translate(-1px, -1px); }
      100% { transform: translate(1px, 2px); }
    }
    .shake { animation: shake 0.3s; }

    /* èƒŒæ™¯æç”» */
    #game-screen {
      flex: 1; display: flex; flex-direction: column;
      background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 40%, #228b22 40%, #006400 100%);
      border: 4px solid #fff; border-radius: 8px; position: relative; overflow: hidden;
    }
    #mountain {
      position: absolute; top: 30%; left: 0; width: 100%; height: 15%;
      background: #004d00; clip-path: polygon(0% 100%, 15% 20%, 30% 70%, 50% 10%, 70% 60%, 85% 30%, 100% 100%);
    }

    #monster-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 2; }
    #monster-image { font-size: 12vh; filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.5)); transition: transform 0.2s; }
    #monster-name-box { background: rgba(0,0,0,0.8); padding: 2px 12px; border: 2px solid #fff; border-radius: 4px; margin-bottom: 5px; font-weight: bold; }
    
    /* ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º */
    #boss-timer {
      display: none; position: absolute; top: 10px; right: 10px;
      background: #000; color: #ff0000; border: 2px solid #ff0000;
      padding: 5px; font-family: 'Courier New', Courier, monospace; text-align: center; width: 60px;
    }
    #timer-fill-container { width: 100%; height: 4px; background: #333; margin-top: 2px; }
    #timer-fill { height: 100%; background: #ff0000; width: 100%; }

    /* UIã‚¨ãƒªã‚¢ */
    #ui-area { flex: 1.3; display: flex; flex-direction: column; background: #000; border: 4px solid #fff; border-radius: 8px; margin-top: 8px; padding: 10px; }
    #status { display: flex; justify-content: space-around; font-size: 0.8rem; border-bottom: 2px solid #fff; padding-bottom: 8px; margin-bottom: 10px; }
    #question { font-size: 0.9rem; text-align: center; min-height: 3em; display: flex; align-items: center; justify-content: center; line-height: 1.4; }
    #choices { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    #choices button { padding: 12px 5px; font-size: 0.8rem; background: #000; color: #fff; border: 2px solid #fff; border-radius: 4px; font-weight: bold; cursor: pointer; }
    
    #log { font-size: 0.8rem; color: #ffff00; text-align: center; margin: 8px 0; height: 1.2em; font-weight: bold; }
    #next { width: 100%; padding: 12px; background: #fff; color: #000; font-weight: bold; border: none; display: none; border-radius: 4px; font-size: 1rem; }
    
    .correct { background: #2ecc71 !important; color: #fff !important; }
    .wrong { background: #e74c3c !important; color: #fff !important; }
    .boss-mode { border-color: #ff0000 !important; }
  </style>
</head>
<body id="main-body">

  <div id="game-screen">
    <div id="mountain"></div>
    <div id="boss-timer">
      <div id="time-num">10</div>
      <div id="timer-fill-container"><div id="timer-fill"></div></div>
    </div>
    
    <div id="monster-area">
      <div id="monster-name-box"><span id="monster-name">...</span></div>
      <div id="monster-image">ğŸ¾</div>
      <div style="width:60%; height:10px; background:#444; border:2px solid #fff; margin-top:8px;">
        <div id="monster-hp" style="height:100%; background:#f00; width:100%; transition:width 0.2s;"></div>
      </div>
    </div>
  </div>

  <div id="ui-area">
    <div id="status">
      <div>LV: <span id="level">1</span></div>
      <div>HP: <span id="hp">100</span></div>
      <div>è‡ªåˆ†: <span id="p-element">ğŸ”¥</span></div>
    </div>
    <div id="question">å•é¡Œèª­ã¿è¾¼ã¿ä¸­...</div>
    <div id="choices"></div>
    <div id="log"></div>
    <button id="next">â–¶ ã¤ãã®ãƒãƒˆãƒ«ã¸</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let player = { level: 1, exp: 0, hp: 100, element: "ğŸ”¥", winCount: 0 };
      const elements = { "ğŸ”¥": "ğŸ’§", "ğŸ’§": "ğŸŒ¿", "ğŸŒ¿": "ğŸ”¥" };
      let timerInt;
      let timeLeft = 10;
      let isBoss = false;

      // å•é¡Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼šç©´åŸ‹ã‚(G), å˜èª(W), ç†Ÿèª(P)ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãé…ç½®
      const masterQuestions = [
        // ã€ç©´åŸ‹ã‚æ–‡æ³•ã€‘
        { q: "I (  ) breakfast at 7:00 this morning.", choices: ["ate", "eat", "eaten", "eating"], a: "ate" },
        { q: "The boy (  ) is running is my brother.", choices: ["who", "which", "whose", "whom"], a: "who" },
        { q: "This cake (  ) made by my mother.", choices: ["was", "is", "did", "has"], a: "was" },
        { q: "He is (  ) than I am.", choices: ["taller", "tall", "tallest", "more tall"], a: "taller" },
        { q: "I have (  ) to London twice.", choices: ["been", "gone", "be", "go"], a: "been" },
        { q: "If I (  ) a bird, I would fly.", choices: ["were", "am", "was", "is"], a: "were" },
        { q: "She stopped (  ) the piano.", choices: ["playing", "to play", "play", "played"], a: "playing" },
        { q: "It is easy (  ) me to solve it.", choices: ["for", "of", "to", "at"], a: "for" },
        // ã€è‹±å˜èªã€‘
        { q: "ã€Œenvironmentã€ã®æ„å‘³ã¯ï¼Ÿ", choices: ["ç’°å¢ƒ", "æ”¿åºœ", "ç¿’æ…£", "æœŸå¾…"], a: "ç’°å¢ƒ" },
        { q: "ã€Œincreaseã€ã®æ„å‘³ã¯ï¼Ÿ", choices: ["å¢—ãˆã‚‹", "æ¸›ã‚‹", "æ­¢ã¾ã‚‹", "å»ã‚‹"], a: "å¢—ãˆã‚‹" },
        { q: "ã€Œnecessaryã€ã®æ„å‘³ã¯ï¼Ÿ", choices: ["å¿…è¦ãª", "ä¾¿åˆ©ãª", "æœ‰åãª", "é«˜ä¾¡ãª"], a: "å¿…è¦ãª" },
        { q: "ã€Œrealizeã€ã®æ„å‘³ã¯ï¼Ÿ", choices: ["æ°—ã¥ã", "å®Ÿç¾ã™ã‚‹", "ç¹°ã‚Šè¿”ã™", "ä¿®ç†ã™ã‚‹"], a: "æ°—ã¥ã" },
        { q: "ã€Œimproveã€ã®æ„å‘³ã¯ï¼Ÿ", choices: ["å‘ä¸Šã•ã›ã‚‹", "æ¸›å°‘ã•ã›ã‚‹", "éš ã™", "é ¼ã‚€"], a: "å‘ä¸Šã•ã›ã‚‹" },
        { q: "ã€Œopportunityã€ã®æ„å‘³ã¯ï¼Ÿ", choices: ["æ©Ÿä¼š", "å ´æ‰€", "æ™‚é–“", "æˆåŠŸ"], a: "æ©Ÿä¼š" },
        // ã€ç†Ÿèªã€‘
        { q: "ã€Œtake care (  )ã€ã§ã€Œä¸–è©±ã‚’ã™ã‚‹ã€", choices: ["of", "for", "to", "with"], a: "of" },
        { q: "ã€Œlook forward (  )ã€ã§ã€Œæ¥½ã—ã¿ã«å¾…ã¤ã€", choices: ["to", "at", "for", "in"], a: "to" },
        { q: "ã€Œbe good (  )ã€ã§ã€Œå¾—æ„ã§ã‚ã‚‹ã€", choices: ["at", "in", "for", "to"], a: "at" },
        { q: "ã€Œgive (  )ã€ã§ã€Œã‚ãã‚‰ã‚ã‚‹ã€", choices: ["up", "off", "out", "away"], a: "up" },
        { q: "ã€Œlook (  )ã€ã§ã€Œã€œã‚’ã•ãŒã™ã€", choices: ["for", "at", "after", "into"], a: "for" },
        { q: "ã€Œby the (  )ã€ã§ã€Œã¨ã“ã‚ã§ã€", choices: ["way", "road", "street", "time"], a: "way" }
      ];

      // å‡ºé¡Œæ¸ˆã¿ã‚’ç®¡ç†ã™ã‚‹ãƒ—ãƒ¼ãƒ«
      let pool = [];

      function refreshPool() {
        pool = [...masterQuestions].sort(() => Math.random() - 0.5);
      }

      function nextBattle() {
        player.winCount++;
        isBoss = player.winCount % 5 === 0;
        
        const monsters = [{n:"ã‚¹ãƒ©ã‚¤ãƒ ",i:"ğŸ’§",t:"ğŸ’§"},{n:"ãƒ‰ãƒ©ã‚­ãƒ¼",i:"ğŸ¦‡",t:"ğŸŒ¿"},{n:"ã‚´ãƒ¼ã‚¹ãƒˆ",i:"ğŸ‘»",t:"ğŸ”¥"}];
        const bosses = [{n:"ã‚Šã‚…ã†ãŠã†",i:"ğŸ²",t:"ğŸ”¥"},{n:"ã‚¯ãƒ©ãƒ¼ã‚±ãƒ³",i:"ğŸ¦‘",t:"ğŸ’§"},{n:"å¤§é•·è€",i:"ğŸ‘´",t:"ğŸŒ¿"}];
        
        let m = isBoss ? bosses[Math.floor(Math.random() * bosses.length)] : monsters[Math.floor(Math.random() * monsters.length)];
        window.currentMonster = { ...m, maxHp: isBoss ? 250 : 50, hp: isBoss ? 250 : 50 };

        document.getElementById("monster-name").textContent = (isBoss ? "BOSS: " : "") + window.currentMonster.n;
        document.getElementById("monster-image").textContent = window.currentMonster.i;
        document.getElementById("boss-timer").style.display = isBoss ? "block" : "none";
        document.getElementById("ui-area").className = isBoss ? "boss-mode" : "";
        document.getElementById("next").style.display = "none";
        document.getElementById("log").textContent = "";
        
        loadQuestion();
        updateHpDisplay();
      }

      function loadQuestion() {
        clearInterval(timerInt);
        // ãƒ—ãƒ¼ãƒ«ãŒç©ºã«ãªã£ãŸã‚‰è£œå……ï¼ˆã“ã‚Œã§ç¹°ã‚Šè¿”ã—ã‚’é˜²æ­¢ï¼‰
        if (pool.length === 0) refreshPool();
        
        const qData = pool.pop();
        document.getElementById("question").textContent = qData.q;
        const choicesEl = document.getElementById("choices");
        choicesEl.innerHTML = "";

        [...qData.choices].sort(() => Math.random() - 0.5).forEach(c => {
          const btn = document.createElement("button");
          btn.textContent = c;
          btn.onclick = () => checkAnswer(c, qData.a, btn);
          choicesEl.appendChild(btn);
        });

        if (isBoss) startBossTimer();
      }

      function startBossTimer() {
        timeLeft = 10;
        document.getElementById("time-num").textContent = timeLeft;
        document.getElementById("timer-fill").style.width = "100%";
        
        timerInt = setInterval(() => {
          timeLeft -= 0.1;
          document.getElementById("time-num").textContent = Math.ceil(timeLeft);
          document.getElementById("timer-fill").style.width = (timeLeft * 10) + "%";
          
          if (timeLeft <= 0) {
            clearInterval(timerInt);
            handleDamage(25, "æ™‚é–“åˆ‡ã‚Œï¼");
          }
        }, 100);
      }

      function checkAnswer(choice, answer, btn) {
        clearInterval(timerInt);
        const buttons = document.querySelectorAll("#choices button");
        buttons.forEach(b => {
          b.disabled = true;
          if (b.textContent === answer) b.classList.add("correct");
        });

        if (choice === answer) {
          let damage = (elements[player.element] === window.currentMonster.t) ? 60 : 25;
          window.currentMonster.hp -= damage;
          document.getElementById("log").textContent = "æ­£è§£ï¼ æ”»æ’ƒï¼";
          // æ•µã‚’å°‘ã—è·³ã­ã•ã›ã‚‹æ¼”å‡º
          document.getElementById("monster-image").style.transform = "scale(1.3)";
          setTimeout(() => document.getElementById("monster-image").style.transform = "scale(1)", 150);
        } else {
          btn.classList.add("wrong");
          handleDamage(20, "ä¸æ­£è§£ï¼");
        }

        setTimeout(() => {
          if (window.currentMonster.hp <= 0) {
            document.getElementById("log").textContent = "ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’å€’ã—ãŸï¼";
            player.exp += isBoss ? 150 : 35;
            document.getElementById("next").style.display = "block";
            levelUpCheck();
          } else if (player.hp <= 0) {
            document.getElementById("log").textContent = "å†’é™ºãŒçµ‚ã‚ã£ã¦ã—ã¾ã£ãŸ...";
            player.hp = 100; player.winCount = 0;
            document.getElementById("next").textContent = "â–¶ å¾©æ´»ã™ã‚‹";
            document.getElementById("next").style.display = "block";
          } else {
            loadQuestion();
          }
          updateHpDisplay();
        }, 800);
      }

      function handleDamage(dmg, msg) {
        player.hp -= dmg;
        document.getElementById("log").textContent = msg + " ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼";
        document.getElementById("main-body").classList.add("shake");
        setTimeout(() => document.getElementById("main-body").classList.remove("shake"), 300);
      }

      function updateHpDisplay() {
        document.getElementById("hp").textContent = player.hp;
        document.getElementById("monster-hp").style.width = (window.currentMonster.hp / window.currentMonster.maxHp * 100) + "%";
        document.getElementById("level").textContent = player.level;
        document.getElementById("p-element").textContent = player.element;
      }

      function levelUpCheck() {
        if (player.exp >= 100) {
          player.level++; player.exp = 0;
          player.element = ["ğŸ”¥", "ğŸ’§", "ğŸŒ¿"][player.level
