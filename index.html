<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ENGLISH QUEST 300 - BOSS RAID</title>
  <style>
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: #0f0c29; color: #fff; font-family: sans-serif; }
    body { display: flex; flex-direction: column; box-sizing: border-box; padding: 8px; }
    h1 { font-size: 0.9rem; margin: 0; text-align: center; color: #eccc68; }
    
    /* „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„Éº */
    #status { display: flex; justify-content: space-around; background: rgba(255,255,255,0.1); padding: 5px; font-size: 0.7rem; border-radius: 8px; flex-shrink: 0; margin-top: 4px; }
    
    /* „Éú„ÇπÂ∞ÇÁî®ÔºöË≠¶Âëä„Ç¢„É©„Éº„Éà */
    #boss-warning { display: none; position: absolute; top: 40%; width: 100%; text-align: center; font-weight: bold; font-size: 2rem; color: #ff4757; text-shadow: 2px 2px #000; z-index: 10; pointer-events: none; }

    #monster-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 0; position: relative; }
    #monster-image { font-size: 10vh; margin: 5px 0; transition: transform 0.2s, filter 0.3s; }
    #monster-name { font-size: 0.9rem; font-weight: bold; }
    .hp-bar-container { width: 60%; height: 8px; background: #333; border-radius: 4px; overflow: hidden; border: 1px solid #555; }
    #monster-hp { height: 100%; background: #ff4757; width: 100%; transition: width 0.3s; }

    /* „Éú„ÇπÊà¶Â∞ÇÁî®Ôºö„Çø„Ç§„Éû„Éº„Éê„Éº */
    #timer-container { width: 80%; height: 4px; background: #222; margin-top: 10px; display: none; }
    #timer-bar { height: 100%; background: #00d2ff; width: 100%; }

    #question-area { flex: 1.6; display: flex; flex-direction: column; justify-content: center; min-height: 0; padding: 0 5px; }
    #question { font-size: 0.85rem; margin-bottom: 8px; color: #ffa502; font-weight: bold; text-align: center; min-height: 3.2em; line-height: 1.3; }
    #choices { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    #choices button { padding: 14px 4px; font-size: 0.75rem; border-radius: 8px; border: none; background: #f1f2f6; font-weight: bold; color: #2f3542; cursor: pointer; }

    #footer { height: 70px; flex-shrink: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    #log { font-size: 0.8rem; color: #2ed573; margin-bottom: 5px; font-weight: bold; text-align: center; }
    #next { width: 90%; padding: 12px; font-size: 1rem; background: linear-gradient(to right, #ff416c, #ff4b2b); border: none; border-radius: 25px; color: white; font-weight: bold; display: none; box-shadow: 0 4px #c0392b; }
    
    .correct { background: #2ed573 !important; color: white !important; }
    .wrong { background: #ff4757 !important; color: white !important; }
    .boss-bg { background: radial-gradient(circle, #2c003e 0%, #000000 100%) !important; }
  </style>
</head>
<body>
  <div id="boss-warning">WARNING!</div>
  <h1>‚öîÔ∏è ENGLISH QUEST</h1>
  
  <div id="status">
    <div>LV: <span id="level">1</span></div>
    <div>HP: <span id="hp">100</span></div>
    <div>Â±ûÊÄß: <span id="p-element">üî•</span></div>
  </div>

  <div id="monster-area">
    <div id="monster-name">...</div>
    <div id="monster-image">üêæ</div>
    <div class="hp-bar-container"><div id="monster-hp"></div></div>
    <div id="timer-container"><div id="timer-bar"></div></div>
  </div>

  <div id="question-area">
    <div id="question"></div>
    <div id="choices"></div>
  </div>

  <div id="footer">
    <div id="log"></div>
    <button id="next">‚ñ∂ Ê¨°„ÅÆ„Éê„Éà„É´„Å∏</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let player = { level: 1, exp: 0, hp: 100, element: "üî•", winCount: 0 };
      const elements = { "üî•": "üíß", "üíß": "üåø", "üåø": "üî•" };
      let timerInterval;
      let timeLeft;
      let isBoss = false;

      // ÂïèÈ°å„Éá„Éº„ÇøÔºàÁü≠Á∏Æ„Åó„Å¶Êé≤Ëºâ„ÄÅÂÆüÈöõ„ÅØ‰ª•Ââç„ÅÆÂÖ®„Éá„Éº„Çø„Çí‰øùÊåÅÂèØËÉΩÔºâ
      const masterQuestions = [
        { q: "It is natural ( ) him to get angry.", choices: ["for", "of", "to", "at"], a: "for" },
        { q: "He ( ) have been rich when he was young.", choices: ["must", "should", "can", "shall"], a: "must" },
        { q: "This is the hospital ( ) my aunt works.", choices: ["where", "which", "that", "who"], a: "where" },
        { q: "I wish I ( ) play the piano like her.", choices: ["could", "can", "will", "may"], a: "could" },
        { q: "„Äåalternative„Äç„ÅÆÊÑèÂë≥„ÅØÔºü", choices: ["‰ª£„Çè„Çä„ÅÆ", "ÊúÄÊñ∞„ÅÆ", "Âè§„ÅÑ", "È´ò„ÅÑ"], a: "‰ª£„Çè„Çä„ÅÆ" },
        { q: "„Äåessential„Äç„ÅÆÊÑèÂë≥„ÅØÔºü", choices: ["‰∏çÂèØÊ¨†„Å™", "Á∞°Âçò„Å™", "Âç±Èô∫„Å™", "Áèç„Åó„ÅÑ"], a: "‰∏çÂèØÊ¨†„Å™" }
        // ... ‰ªñ290Âïè
      ];
      // ÂÆüÈöõ„Å´„ÅØ„Åì„Åì„Å´‰ª•Ââç„ÅÆÂÖ®300Âïè„ÇíÂÖ•„Çå„Çã

      let pool = [...masterQuestions];
      let monster = {};

      function updateStatus() {
        document.getElementById("level").textContent = player.level;
        document.getElementById("hp").textContent = player.hp;
        document.getElementById("p-element").textContent = player.element;
      }

      function nextBattle() {
        player.winCount++;
        isBoss = player.winCount % 5 === 0;
        
        if (isBoss) {
          document.body.classList.add("boss-bg");
          document.getElementById("boss-warning").style.display = "block";
          document.getElementById("timer-container").style.display = "block";
          setTimeout(() => { document.getElementById("boss-warning").style.display = "none"; }, 1000);
        } else {
          document.body.classList.remove("boss-bg");
          document.getElementById("timer-container").style.display = "none";
        }

        const mData = isBoss ? 
          [{n:"ÁÇé„ÅÆÂ∏ùÁéã",h:300,i:"üëπ",t:"üî•"},{n:"Ê∑±Êµ∑„ÅÆÁ•û",h:350,i:"üî±",t:"üíß"},{n:"Â§™Âè§„ÅÆÊ®π",h:320,i:"üå≥",t:"üåø"}] :
          [{n:"ÁÅ´„Çπ„É©",h:40,i:"üî•",t:"üî•"},{n:"Ê∞¥Á´ú",h:45,i:"üíß",t:"üíß"},{n:"Ê£ÆÁ≤æ",h:40,i:"üåø",t:"üåø"}];
        
        monster = {...mData[Math.floor(Math.random()*mData.length)]};
        monster.maxH = monster.h;
        document.getElementById("monster-name").textContent = (isBoss ? "RAID BOSS: " : "") + monster.n;
        document.getElementById("monster-image").textContent = monster.i;
        document.getElementById("monster-image").style.filter = isBoss ? "drop-shadow(0 0 10px red)" : "none";
        document.getElementById("log").textContent = isBoss ? "„Äê„Éú„ÇπÊà¶„ÄëÊôÇÈñìÂàá„Çå„Å´Ê≥®ÊÑè„Åõ„ÇàÔºÅ" : "";
        document.getElementById("next").style.display = "none";
        
        loadQuestion();
        updateMonsterHp();
      }

      function startTimer() {
        clearInterval(timerInterval);
        if (!isBoss) return;
        timeLeft = 100;
        timerInterval = setInterval(() => {
          timeLeft -= 1.5; // „Éú„ÇπÊà¶„ÅÆÂà∂ÈôêÊôÇÈñì
          document.getElementById("timer-bar").style.width = timeLeft + "%";
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            timeUp();
          }
        }, 100);
      }

      function timeUp() {
        document.getElementById("log").textContent = "ÊôÇÈñìÂàá„ÇåÔºÅ„ÉÄ„É°„Éº„Ç∏ÔºÅ";
        player.hp -= 20;
        updateStatus();
        if (player.hp > 0) loadQuestion();
        else gameOver();
      }

      function loadQuestion() {
        clearInterval(timerInterval);
        if(pool.length === 0) pool = [...masterQuestions];
        const idx = Math.floor(Math.random()*pool.length);
        const qData = pool.splice(idx, 1)[0];
        document.getElementById("question").textContent = qData.q;
        const choicesEl = document.getElementById("choices");
        choicesEl.innerHTML = "";
        
        [...qData.choices].sort(()=>Math.random()-0.5).forEach(c => {
          const btn = document.createElement("button");
          btn.textContent = c;
          btn.onclick = () => checkAnswer(c, qData.a, btn);
          choicesEl.appendChild(btn);
        });
        startTimer();
      }

      function checkAnswer(choice, answer, btn) {
        clearInterval(timerInterval);
        const buttons = document.querySelectorAll("#choices button");
        buttons.forEach(b => {
          b.disabled = true;
          if(b.textContent === answer) b.classList.add("correct");
        });

        if (choice === answer) {
          let isAdv = elements[player.element] === monster.t;
          let damage = isAdv ? (isBoss ? 60 : 40) : (isBoss ? 25 : 15);
          monster.h -= damage;
          document.getElementById("log").textContent = isAdv ? "Âº±ÁÇπ„Å´„ÇØ„É™„ÉÜ„Ç£„Ç´„É´ÔºÅ" : "Ê≠£Ëß£ÔºÅ";
        } else {
          btn.classList.add("wrong");
          player.hp -= (isBoss ? 30 : 15);
          document.getElementById("log").textContent = "‰∏çÊ≠£Ëß£ÔºÅÁóõÊÅ®„ÅÆ„ÉÄ„É°„Éº„Ç∏ÔºÅ";
        }

        setTimeout(() => {
          if (monster.h <= 0) {
            win();
          } else if (player.hp <= 0) {
            gameOver();
          } else {
            loadQuestion();
          }
          updateStatus();
          updateMonsterHp();
        }, 800);
      }

      function win() {
        clearInterval(timerInterval);
        document.getElementById("log").textContent = isBoss ? "„Éú„Çπ„ÇíË®é‰ºê„Åó„ÅüÔºÅ" : "„É¢„É≥„Çπ„Çø„Éº„ÇíÂÄí„Åó„ÅüÔºÅ";
        player.exp += isBoss ? 200 : 40;
        document.getElementById("next").style.display = "block";
        levelUpCheck();
      }

      function gameOver() {
        clearInterval(timerInterval);
        document.getElementById("log").textContent = "ÂäõÂ∞Ω„Åç„Åü...";
        player.hp = 100;
        player.winCount = 0;
        document.getElementById("next").textContent = "‚ñ∂ Ë°ó„Å´Êàª„Å£„Å¶Âæ©Ê¥ª„Åô„Çã";
        document.getElementById("next").style.display = "block";
      }

      function updateMonsterHp() {
        document.getElementById("monster-hp").style.width = Math.max((monster.h / monster.maxH)*100, 0) + "%";
      }

      function levelUpCheck() {
        if (player.exp >= player.level * 100) {
          player.level++; player.exp = 0;
          player.element = ["üî•", "üíß", "üåø"][player.level % 3];
        }
      }

      document.getElementById("next").onclick = () => {
        document.getElementById("next").textContent = "‚ñ∂ Ê¨°„ÅÆ„Éê„Éà„É´„Å∏";
        nextBattle();
      };

      updateStatus();
      nextBattle();
    });
  </script>
</body>
</html>
