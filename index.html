<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ENGLISH QUEST - 150 FULL & SURVIVAL</title>
  <style>
    /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¶™æ‰¿ */
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: #000; color: #fff; font-family: sans-serif; }
    body { display: flex; flex-direction: column; box-sizing: border-box; padding: 10px; }
    #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; }
    #game-container { display: none; flex: 1; flex-direction: column; }
    #game-screen { flex: 1; display: flex; flex-direction: column; background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 40%, #228b22 40%, #006400 100%); border: 4px solid #fff; border-radius: 8px; position: relative; overflow: hidden; }
    #monster-area { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 2; }
    #monster-image { font-size: 8vh; filter: drop-shadow(4px 4px 0px rgba(0,0,0,0.5)); transition: transform 0.2s; }
    #ui-area { flex: 1.5; display: flex; flex-direction: column; background: #000; border: 4px solid #fff; border-radius: 8px; margin-top: 8px; padding: 10px; z-index: 5; }
    #status { display: flex; justify-content: space-around; font-size: 0.8rem; border-bottom: 2px solid #fff; padding-bottom: 8px; margin-bottom: 5px; }
    
    /* HPã‚¢ãƒ©ãƒ¼ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .hp-danger { color: #ff4757 !important; font-weight: bold; animation: blink 0.5s infinite alternate; }
    @keyframes blink { from { opacity: 1; } to { opacity: 0.4; } }

    #question { font-size: 0.85rem; text-align: center; min-height: 4em; display: flex; align-items: center; justify-content: center; }
    #choices { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    #choices button { padding: 12px 5px; font-size: 0.8rem; background: #000; color: #fff; border: 2px solid #fff; border-radius: 4px; }
    
    /* å›å¾©ãƒœã‚¿ãƒ³ */
    #heal-btn { display: none; width: 100%; margin-bottom: 10px; padding: 12px; background: #2ed573; color: #fff; border: none; border-radius: 4px; font-weight: bold; font-size: 1rem; cursor: pointer; }
    
    #log { font-size: 0.85rem; color: #ffff00; text-align: center; margin: 8px 0; height: 1.2em; font-weight: bold; }
    #next { width: 100%; padding: 15px; background: #fff; color: #000; font-weight: bold; border: none; display: none; border-radius: 4px; }
    #review-btn { font-size: 0.7rem; color: #aaa; text-align: right; text-decoration: underline; margin-top: 8px; cursor: pointer; }
    
    #review-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; flex-direction: column; padding: 20px; box-sizing: border-box; }
    #review-content { flex: 1; overflow-y: auto; background: #111; padding: 15px; border-radius: 8px; }
    .correct { background: #2ecc71 !important; }
    .wrong { background: #e74c3c !important; }
    .shake { animation: shake 0.2s ease-in-out 2; }
    @keyframes shake { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(-8px, 0); } 75% { transform: translate(8px, 0); } }
  </style>
</head>
<body id="main-body">

  <div id="loading-screen">
    <div style="border: 4px solid #333; border-top: 4px solid #fff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
    <p style="margin-top: 20px;">LOADING RECOVERY SYSTEM...</p>
  </div>

  <div id="review-modal">
    <h2 style="font-size: 1.1rem;">ğŸ“œ å¾©ç¿’å¸³</h2>
    <div id="review-content"></div>
    <button id="close-review" style="padding:10px; margin-top:10px;">é–‰ã˜ã‚‹</button>
  </div>

  <div id="game-container">
    <div id="game-screen">
      <div id="monster-area">
        <div id="monster-name-box" style="background:rgba(0,0,0,0.7); border:1px solid #fff; padding:2px 10px;"><span id="monster-name">...</span></div>
        <div id="monster-image">ğŸ¾</div>
        <div style="width:120px; height:8px; background:#444; border:1px solid #fff; margin-top:5px;">
          <div id="monster-hp" style="height:100%; background:#f00; width:100%; transition:width 0.2s;"></div>
        </div>
      </div>
    </div>
    
    <div id="ui-area">
      <div id="status">
        <div>LV: <span id="level">1</span></div>
        <div id="hp-box">HP: <span id="hp">100</span></div>
        <div>å±æ€§: <span id="p-element">ğŸ”¥</span></div>
      </div>
      
      <div id="question"></div>
      
      <button id="heal-btn">ğŸŒ¿ è–¬è‰ã‚’ä½¿ã† (HPå…¨å›å¾©)</button>
      
      <div id="choices"></div>
      <div id="log"></div>
      <button id="next"></button>
      <div id="review-btn">âŒ é–“é•ãˆãŸå•é¡Œã‚’ç¢ºèªã™ã‚‹</div>
    </div>
  </div>

  <script>
    // å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆ150å•ã®å®šç¾©ã¯å‰å›ã®ã‚‚ã®ã‚’ç¶­æŒï¼‰
    const masterQuestions = [
      { q: "I (  ) my homework yet.", choices: ["haven't finished", "didn't finish", "don't finish", "finished"], a: "haven't finished" },
      { q: "Tokyo is the city (  ) I was born.", choices: ["where", "which", "that", "there"], a: "where" },
      { q: "If I (  ) a bird, I would fly to you.", choices: ["were", "am", "was", "be"], a: "were" },
      { q: "ã€Œenvironmentã€ã®æ„å‘³ã¯ï¼Ÿ", choices: ["ç’°å¢ƒ", "æ”¿åºœ", "æœŸå¾…", "æ”¹å–„"], a: "ç’°å¢ƒ" },
      // ... (ã“ã“ã«150å•ã®æ®‹ã‚Šã®ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã‚Šã¾ã™)
    ];

    let player = { level: 1, exp: 0, hp: 100, element: "ğŸ”¥", winCount: 0 };
    let pool = [], usedPool = [], wrongAnswers = [];
    let currentQuestion = null, currentMonster = {};

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function init() {
      setTimeout(() => {
        pool = shuffle([...masterQuestions]);
        document.getElementById("loading-screen").style.display = "none";
        document.getElementById("game-container").style.display = "flex";
        nextBattle();
      }, 800);
    }

    function nextBattle() {
      player.winCount++;
      const isBoss = player.winCount % 5 === 0;
      currentMonster = { n: isBoss ? "BOSS" : "ENEMY", i: isBoss ? "ğŸ²" : "ğŸ‘¾", maxHp: isBoss ? 200 : 70, hp: isBoss ? 200 : 70 };
      document.getElementById("monster-name").textContent = currentMonster.n;
      document.getElementById("monster-image").textContent = currentMonster.i;
      document.getElementById("next").style.display = "none";
      loadQuestion();
      updateDisplay();
    }

    function loadQuestion() {
      if (pool.length === 0) { pool = shuffle([...usedPool]); usedPool = []; }
      currentQuestion = pool.pop();
      document.getElementById("question").textContent = currentQuestion.q;
      const choicesEl = document.getElementById("choices");
      choicesEl.innerHTML = "";
      shuffle([...currentQuestion.choices]).forEach(c => {
        const btn = document.createElement("button");
        btn.textContent = c;
        btn.onclick = () => checkAnswer(c, currentQuestion.a, btn);
        choicesEl.appendChild(btn);
      });
    }

    function checkAnswer(choice, answer, btn) {
      const buttons = document.querySelectorAll("#choices button");
      buttons.forEach(b => b.disabled = true);

      if (choice === answer) {
        btn.classList.add("correct");
        usedPool.push(currentQuestion);
        currentMonster.hp -= 35;
        document.getElementById("log").textContent = "æ­£è§£ï¼";
      } else {
        btn.classList.add("wrong");
        buttons.forEach(b => { if(b.textContent === answer) b.classList.add("correct"); });
        if (!wrongAnswers.some(item => item.q === currentQuestion.q)) wrongAnswers.push(currentQuestion);
        pool.unshift(currentQuestion);
        player.hp -= 15;
        document.getElementById("log").textContent = "ãƒŸã‚¹ï¼ 15ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼";
        document.getElementById("main-body").classList.add("shake");
        setTimeout(() => document.getElementById("main-body").classList.remove("shake"), 300);
      }

      setTimeout(() => {
        if (currentMonster.hp <= 0) {
          document.getElementById("log").textContent = "å‹åˆ©ï¼";
          player.exp += 40;
          document.getElementById("next").textContent = "â–¶ æ¬¡ã®ãƒãƒˆãƒ«ã¸";
          document.getElementById("next").style.display = "block";
          if(player.exp >= 100) { player.level++; player.exp = 0; }
        } else if (player.hp <= 0) {
          document.getElementById("log").textContent = "å…¨æ»…...";
          player.hp = 100; player.winCount = 0;
          document.getElementById("next").textContent = "â–¶ å¾©æ´»ã™ã‚‹";
          document.getElementById("next").style.display = "block";
        } else {
          loadQuestion();
        }
        updateDisplay();
      }, 1000);
    }

    // â˜…ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ: HPã®æ¼”å‡ºã¨å›å¾©ãƒœã‚¿ãƒ³ã®åˆ¶å¾¡
    function updateDisplay() {
      const hpText = document.getElementById("hp");
      hpText.textContent = player.hp;

      // HPãŒ30ä»¥ä¸‹ã®æ™‚ã€æ–‡å­—ã‚’èµ¤ãç‚¹æ»…ã•ã›ã‚‹
      if (player.hp <= 30) {
        hpText.parentElement.classList.add("hp-danger");
      } else {
        hpText.parentElement.classList.remove("hp-danger");
      }

      // HPãŒ20ä»¥ä¸‹ã®æ™‚ã€è–¬è‰ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹
      const healBtn = document.getElementById("heal-btn");
      if (player.hp > 0 && player.hp <= 20) {
        healBtn.style.display = "block";
      } else {
        healBtn.style.display = "none";
      }

      document.getElementById("level").textContent = player.level;
      document.getElementById("p-element").textContent = ["ğŸ”¥", "ğŸ’§", "ğŸŒ¿"][player.level % 3];
      document.getElementById("monster-hp").style.width = (currentMonster.hp / currentMonster.maxHp * 100) + "%";
    }

    // è–¬è‰ãƒœã‚¿ãƒ³ã®å‹•ä½œ
    document.getElementById("heal-btn").onclick = () => {
      player.hp = 100;
      document.getElementById("log").textContent = "è–¬è‰ã§HPãŒå…¨å¿«ã—ãŸï¼";
      updateDisplay();
    };

    document.getElementById("review-btn").onclick = () => {
      const content = document.getElementById("review-content");
      content.innerHTML = wrongAnswers.length === 0 ? "ãƒŸã‚¹ãªã—ï¼" : 
        wrongAnswers.map((item, i) => `<div style="margin-bottom:10px;">${i+1}. ${item.q}<br><b style="color:#2ecc71;">æ­£è§£: ${item.a}</b></div>`).join("");
      document.getElementById("review-modal").style.display = "flex";
    };

    document.getElementById("close-review").onclick = () => document.getElementById("review-modal").style.display = "none";
    document.getElementById("next").onclick = nextBattle;
    window.onload = init;
  </script>
</body>
</html>
