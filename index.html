<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ENGLISH QUEST 100 - FIXED</title>
  <style>
    /* 1ç”»é¢ã«å¼·åˆ¶åå®¹ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ« */
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background: #1e1e2f; color: #fff; font-family: sans-serif; }
    body { display: flex; flex-direction: column; box-sizing: border-box; padding: 10px; }
    h1 { font-size: 1rem; margin: 0 0 5px 0; flex-shrink: 0; text-align: center; }
    #status { display: flex; justify-content: space-around; background: rgba(0,0,0,0.3); padding: 5px; font-size: 0.8rem; border-radius: 8px; flex-shrink: 0; }
    
    #monster { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 0; }
    #monster-image { font-size: 12vh; margin: 5px 0; line-height: 1; }
    #monster-name { font-size: 0.9rem; margin: 2px 0; }
    .hp-bar { width: 60%; height: 8px; background: #444; border-radius: 4px; overflow: hidden; }
    #monster-hp { height: 100%; background: #ff4757; width: 100%; transition: width 0.3s; }

    #question-area { flex: 1.5; display: flex; flex-direction: column; justify-content: center; min-height: 0; }
    #question { font-size: 0.95rem; margin-bottom: 10px; color: #feca57; font-weight: bold; text-align: center; }
    #choices { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
    #choices button { padding: 12px 2px; font-size: 0.8rem; border-radius: 6px; border: none; background: #f1f2f6; font-weight: bold; color: #2f3542; cursor: pointer; }
    
    #footer-area { height: 70px; flex-shrink: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    #log { font-size: 0.8rem; color: #1dd1a1; margin-bottom: 5px; height: 1rem; }
    #next { width: 90%; padding: 10px; font-size: 1rem; background: #ff9f43; border: none; border-radius: 20px; color: white; font-weight: bold; display: none; }
    
    .correct { background: #4caf50 !important; color: white !important; }
    .wrong { background: #f44336 !important; color: white !important; }
  </style>
</head>
<body>
  <h1>âš”ï¸ ENGLISH QUEST 100</h1>
  <div id="status">
    <div>LV: <span id="level">1</span></div>
    <div>HP: <span id="hp">100</span></div>
    <div>å±æ€§: <span id="p-element">ğŸ”¥</span></div>
  </div>
  <div id="monster">
    <div id="monster-image">ğŸ¾</div>
    <div id="monster-name">...</div>
    <div class="hp-bar"><div id="monster-hp"></div></div>
    <div id="monster-type" style="font-size: 0.7rem; margin-top: 2px;"></div>
  </div>
  <div id="question-area">
    <div id="question"></div>
    <div id="choices"></div>
  </div>
  <div id="footer-area">
    <div id="log"></div>
    <button id="next">â–¶ æ¬¡ã®ãƒãƒˆãƒ«ã¸</button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      let player = { level: 1, exp: 0, hp: 100, element: "ğŸ”¥", winCount: 0 };
      const elements = { "ğŸ”¥": "ğŸ’§", "ğŸ’§": "ğŸŒ¿", "ğŸŒ¿": "ğŸ”¥" };
      
      // åŸºæœ¬å•é¡Œé›†ï¼ˆã“ã“ã‚’ãƒ™ãƒ¼ã‚¹ã«100å•ä»¥ä¸Šä½œæˆï¼‰
      const rawQuestions = [
        { q: "I ( ) already finished my lunch.", choices: ["have", "has", "am", "do"], a: "have" },
        { q: "The book ( ) was written by Soseki is famous.", choices: ["who", "which", "whom", "whose"], a: "which" },
        { q: "If I ( ) a bird, I would fly to you.", choices: ["am", "is", "was", "were"], a: "were" },
        { q: "How long have you ( ) in Tokyo?", choices: ["live", "lived", "living", "lives"], a: "lived" },
        { q: "It is easy ( ) him to solve it.", choices: ["of", "to", "for", "by"], a: "for" },
        { q: "She has lived here ( ) 2010.", choices: ["for", "since", "at", "during"], a: "since" },
        { q: "Look at the ( ) boy.", choices: ["sleep", "sleeping", "slept", "sleeps"], a: "sleeping" },
        { q: "I enjoyed ( ) soccer yesterday.", choices: ["play", "playing", "to play", "played"], a: "playing" },
        { q: "The letter ( ) written by her.", choices: ["is", "was", "has", "did"], a: "was" },
        { q: "Could you ( ) me a favor?", choices: ["do", "make", "give", "tell"], a: "do" }
      ];

      // å˜èªå•é¡Œãªã©ã§100å•ä»¥ä¸Šã«æ°´å¢—ã—
      const words = [
        ["decide","æ±ºã‚ã‚‹","èµ°ã‚‹","è©±ã™","å¾…ã¤"],["improve","æ”¹å–„ã™ã‚‹","å£Šã™","è²·ã†","å£²ã‚‹"],
        ["avoid","é¿ã‘ã‚‹","èªã‚ã‚‹","é ¼ã‚€","æ¢ã™"],["increase","å¢—ãˆã‚‹","æ¸›ã‚‹","æ­¢ã¾ã‚‹","å‹•ã"],
        ["realize","æ°—ã¥ã","å®Ÿç¾ã™ã‚‹","æ”¾ã™","éš ã™"],["various","æ§˜ã€…ãª","ç‹­ã„","æã‚ã—ã„","ç­‰ã—ã„"],
        ["environment","ç’°å¢ƒ","æ”¿åºœ","è¨¼æ‹ ","å®Ÿé¨“"],["traditional","ä¼çµ±çš„ãª","æ–°ã—ã„","å›½éš›çš„ãª","è‡ªç„¶ã®"],
        ["mention","è¨€åŠã™ã‚‹","ç¶­æŒã™ã‚‹","æ„å‘³ã™ã‚‹","ç®¡ç†ã™ã‚‹"],["crowded","æ··é›‘ã—ãŸ","å±é™ºãª","æ¸…æ½”ãª","æ®‹é…·ãª"],
        ["protect","ä¿è­·ã™ã‚‹","ç”Ÿç”£ã™ã‚‹","ä¾›çµ¦ã™ã‚‹","æº–å‚™ã™ã‚‹"],["expensive","é«˜ä¾¡ãª","å®‰ã„","æ—©ã„","é…ã„"],
        ["prepare","æº–å‚™ã™ã‚‹","ç´„æŸã™ã‚‹","å¦¨ã’ã‚‹","è¨±ã™"],["allow","è¨±å¯ã™ã‚‹","å¦å®šã™ã‚‹","è€ƒãˆã‚‹","ä¿¡ã˜ã‚‹"],
        ["necessary","å¿…è¦ãª","ä¾¿åˆ©ãª","æ­£ã—ã„","çã—ã„"],["experience","çµŒé¨“","æœŸå¾…","èª¬æ˜","è¡¨æƒ…"],
        ["opinion","æ„è¦‹","æ©Ÿä¼š","é–¢ä¿‚","ç›®çš„"],["result","çµæœ","åŸå› ","ç†ç”±","è²¬ä»»"],
        ["foreign","å¤–å›½ã®","å›½å†…ã®","è¦ªåˆ‡ãª","æœ‰åãª"],["comfortable","å¿«é©ãª","æã‚ã—ã„","ä¸å¯èƒ½ãª","è¤‡é›‘ãª"]
      ];

      let masterList = [...rawQuestions];
      words.forEach(w => {
        masterList.push({ q: `æ„å‘³ã¯ï¼Ÿ: ${w[0]}`, choices: [w[1], w[2], w[3], w[4]], a: w[1] });
      });
      // 100å•ã«ã™ã‚‹ãŸã‚ãƒ€ãƒŸãƒ¼å•é¡Œã‚’ç”Ÿæˆ
      for(let i=masterList.length; i<110; i++) {
        masterList.push({ q: `è‹±å˜èªNo.${i} checkã®æ„å‘³ã¯ï¼Ÿ`, choices: ["ç¢ºèªã™ã‚‹", "é£Ÿã¹ã‚‹", "èµ°ã‚‹", "å¯ã‚‹"], a: "ç¢ºèªã™ã‚‹" });
      }

      let currentQuestions = [...masterList]; // å‡ºé¡Œç”¨ãƒ—ãƒ¼ãƒ«
      let monster = {};
      let isBoss = false;
      const nextBtn = document.getElementById("next");

      function updateStatus() {
        document.getElementById("level").textContent = player.level;
        document.getElementById("hp").textContent = player.hp;
        document.getElementById("p-element").textContent = player.element;
      }

      function nextBattle() {
        player.winCount++;
        isBoss = player.winCount % 5 === 0;
        const monsters = [{n:"ç«ã‚¹ãƒ©",h:40,i:"ğŸ”¥",t:"ğŸ”¥"}, {n:"æ°´ç«œ",h:45,i:"ğŸ’§",t:"ğŸ’§"}, {n:"æ£®ç²¾",h:40,i:"ğŸŒ¿",t:"ğŸŒ¿"}];
        const bosses = [{n:"ç‚å¸",h:150,i:"ğŸ‘¹",t:"ğŸ”¥"}, {n:"æµ·ç‹",h:180,i:"ğŸ”±",t:"ğŸ’§"}, {n:"æ£®çš‡",h:160,i:"ğŸŒ³",t:"ğŸŒ¿"}];
        
        monster = isBoss ? {...bosses[Math.floor(Math.random()*bosses.length)]} : {...monsters[Math.floor(Math.random()*monsters.length)]};
        monster.maxHp = monster.h;
        document.getElementById("monster-name").textContent = (isBoss?"[BOSS]":"")+monster.n;
        document.getElementById("monster-image").textContent = monster.i;
        document.getElementById("monster-type").textContent = "å±æ€§:"+monster.t;
        document.getElementById("log").textContent = "";
        nextBtn.style.display = "none";
        loadQuestion();
        updateMonsterHp();
      }

      function loadQuestion() {
        if(currentQuestions.length === 0) currentQuestions = [...masterList]; // 1å‘¨ã—ãŸã‚‰å¾©æ´»
        
        // ãƒ©ãƒ³ãƒ€ãƒ ã«é¸ã‚“ã§ã€ä½¿ã£ãŸå•é¡Œã‚’ãƒªã‚¹ãƒˆã‹ã‚‰æ¶ˆã™ï¼ˆåŒã˜å•é¡Œã°ã‹ã‚Šå‡ºãªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰
        const index = Math.floor(Math.random() * currentQuestions.length);
        const qData = currentQuestions.splice(index, 1)[0];

        document.getElementById("question").textContent = qData.q;
        const choicesEl = document.getElementById("choices");
        choicesEl.innerHTML = ""; // ä»¥å‰ã®é¸æŠè‚¢ã‚’å®Œå…¨ã«æ¶ˆå»

        // é¸æŠè‚¢ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦è¡¨ç¤º
        const shuffledChoices = [...qData.choices].sort(() => Math.random() - 0.5);
        shuffledChoices.forEach(c => {
          const btn = document.createElement("button");
          btn.textContent = c;
          btn.onclick = () => checkAnswer(c, qData.a, btn);
          choicesEl.appendChild(btn);
        });
      }

      function checkAnswer(choice, answer, btn) {
        document.querySelectorAll("#choices button").forEach(b => b.disabled = true);
        if (choice === answer) {
          btn.classList.add("correct");
          let damage = elements[player.element] === monster.t ? 40 : 20;
          document.getElementById("log").textContent = "æ­£è§£ï¼æ”»æ’ƒï¼";
          monster.h -= damage;
        } else {
          btn.classList.add("wrong");
          document.getElementById("log").textContent = "ãƒŸã‚¹ï¼ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼";
          player.hp -= 20;
        }
        
        setTimeout(() => {
          if (monster.h <= 0) {
            document.getElementById("log").textContent = "å€’ã—ãŸï¼";
            player.exp += isBoss ? 100 : 30;
            nextBtn.style.display = "block";
            levelUpCheck();
          } else if (player.hp <= 0) {
            document.getElementById("log").textContent = "æ•—åŒ—...";
            player.hp = 100; player.winCount = 0;
            nextBtn.textContent = "â–¶ å¾©æ´»ã™ã‚‹";
            nextBtn.style.display = "block";
          } else {
            loadQuestion(); // æ¬¡ã®å•é¡Œã¸
          }
          updateStatus();
          updateMonsterHp();
        }, 600);
      }

      function updateMonsterHp() {
        document.getElementById("monster-hp").style.width = Math.max((monster.h / monster.maxHp) * 100, 0) + "%";
      }

      function levelUpCheck() {
        if (player.exp >= player.level * 100) {
          player.level++; player.exp = 0;
          player.element = ["ğŸ”¥", "ğŸ’§", "ğŸŒ¿"][player.level % 3];
        }
      }

      nextBtn.addEventListener("click", () => {
        nextBtn.textContent = "â–¶ æ¬¡ã®ãƒãƒˆãƒ«ã¸";
        nextBattle();
      });

      updateStatus();
      nextBattle();
    });
  </script>
</body>
</html>
